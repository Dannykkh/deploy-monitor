---
date: 2026-02-15
project: deploy-monitor
keywords: []
summary: ""
---

# 2026-02-15

## [06:49] User

deploy-selective-trigger.md를 확인하고 수정을 하자.

## [06:57] User

2단계 부터 진행하려고 해. deploy.bat를감지해서 무조건 배포 하는것이 아니라 상황에 따라서. 백엔드와 프론트 업데이트 할 떄 앱일경우는 백엔드만 보통 업데이트 해서 도커 배포할테니까.

## [06:59:09] Assistant

수정 완료했습니다. 변경 내용을 정리하면:

## 수정 사항

**기존**: git pull 후 변경이 있으면 **무조건 빌드 + 재시작**
**변경**: git pull 후 `DEPLOY_TRIGGERS` 경로에 해당하는 변경이 있을 때만 배포

### 추가된 단계 (4단계 → 5단계)

| 단계 | 내용 |
|------|------|
| **[1/5] Git Pull** | pull 전후 HEAD 해시를 비교해서 변경 여부 판단 |
| **[2/5] Check deploy triggers** | 변경 파일을 `DEPLOY_TRIGGERS`와 매칭 |
| [3/5] Build | 기존과 동일 |
| [4/5] Stop & Deploy | 기존과 동일 |
| [5/5] Restart | 기존과 동일 |

### DEPLOY_TRIGGERS 설정

[code block]

다른 프로젝트에 적용할 때는 이 한 줄만 바꾸면 됩니다:
- 앱 프로젝트: `"backend-spring/ docker-images/ deploy.bat"`
- 단일 백엔드: `"src/ pom.xml Dockerfile deploy.bat"`

### 동작 흐름

- 변경 없음 (`Already up to date`) → 즉시 종료
- 변경은 있지만 README, docs 등만 수정 → `[SKIP]` 빌드 생략
- `DeployMonitor/` 소스 변경 → 빌드 + 배포 진행

`#tags: deploy-bat, selective-trigger, git-pull, deploy-triggers, batch-script`

## [07:05] User

이 프로젝트는 deploy.bat를 감지해서 도커에 배포하는 기능을 가진 프로그램이잖아. c#을 수정해야지.


## [07:09:08] Assistant

빌드 성공입니다. 수정 내용을 정리하겠습니다.

## 수정 완료

### 변경 파일 4개 (+ deploy.bat 원복)

| 파일 | 변경 내용 |
|------|-----------|
| **ProjectInfo.cs** | `DeployTriggers`, `PreviousCommitHash` 프로퍼티 추가 |
| **RepoScanner.cs** | deploy.bat에서 `DEPLOY_TRIGGERS` 값 추출하는 `ExtractDeployTriggers()` 추가 |
| **CommitWatcher.cs** | 새 커밋 감지 시 `project.PreviousCommitHash`에 이전 해시 보존 |
| **DeployRunner.cs** | `CheckDeployTriggersAsync()` — bare repo에서 `git diff --name-only` 로 변경 파일을 트리거 경로와 비교, 매칭 없으면 배포 생략 |

### 사용법

감시 대상 프로젝트의 **deploy.bat**에 한 줄 추가:

[code block]

- **설정 있음** → 해당 경로에 변경이 있을 때만 배포
- **설정 없음** → 기존처럼 모든 변경에 배포 (하위 호환)
- **트리거 확인 실패** → 안전하게 배포 진행

### 동작 예시

README.md만 수정한 커밋이 push되면:
[code block]

`#tags: deploy-monitor, selective-trigger, deploy-triggers, csharp, commit-watcher, deploy-runner`

## [07:23] User

깃에서 최신 떙겨온건가?


## [07:23:50] Assistant

diff가 없으니 원본과 동일합니다. 문제 없습니다.

`#tags: git, deploy-bat, 원복확인`

## [07:24] User

그러면 깃에 푸시하자.


## [07:24:47] Assistant

푸시 완료했습니다.

`#tags: git, push, selective-trigger, deploy-monitor, commit`

## [11:08] User

deploy-selective-trigger.md도 수정해줘 현재 구현에 맞게

## [11:08:58] Assistant

문서를 실제 구현에 맞게 수정했습니다. 주요 변경점:

- 기존의 "계획/설계" 톤 → 실제 구현 완료 상태로 반영
- `List<string>` → 실제 구현인 `string` (공백 구분)으로 수정
- `HEAD@{1}` → 실제 구현인 `PreviousCommitHash` 기반 bare repo diff로 수정
- 동작 흐름도, 로그 출력 예시 추가
- 수동 배포는 트리거 체크 안 하는 점 명시

`#tags: deploy-selective-trigger, documentation, 문서수정`

## [11:30] User

커밋하고 푸시해줘

## [11:31:17] Assistant

커밋 및 푸시 완료했습니다.

`#tags: git, commit, push, documentation`
